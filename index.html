<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#6a11cb">
    <meta name="backend-url" content="https://refreshing-nourishment-production-e7ce.up.railway.app/">
    
    <title>–ó–∞—â–∏—Ç–∞ –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="manifest.json">
    
    <script type="application/json" id="app-config">
        {"backendUrl": "https://refreshing-nourishment-production-e7ce.up.railway.app/"}
    </script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <div class="logo-icon">üõ°Ô∏è</div>
                <h1>–ó–∞—â–∏—Ç–∞ –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω–∏</h1>
            </div>
            <div class="user-info" id="userInfo">
                <div class="user-avatar">üë§</div>
                <div class="user-name">–ì–æ—Å—Ç—å</div>
            </div>
        </header>

        <main>
            <div class="welcome-section">
                <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂!</h2>
                <p class="subtitle">–í–∏—Ä—É—Å "–¢–µ–Ω—å –°–µ—Ç–∏" –∞—Ç–∞–∫—É–µ—Ç –Ω–∞—à—É –¥–µ—Ä–µ–≤–Ω—é. –°–æ–±–µ—Ä–∏ –≤—Å–µ –∞–º—É–ª–µ—Ç—ã –∑–∞—â–∏—Ç—ã!</p>
                
                <div class="quest-info">
                    <div class="info-card">
                        <div class="info-icon">üìç</div>
                        <div class="info-text">
                            <div class="info-label">–õ–æ–∫–∞—Ü–∏–π</div>
                            <div class="info-value" id="locationsCount">0/6</div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">‚ú®</div>
                        <div class="info-text">
                            <div class="info-label">–ê–º—É–ª–µ—Ç–æ–≤</div>
                            <div class="info-value" id="amuletsCount">0/6</div>
                        </div>
                    </div>
                    <div class="info-card">
                        <div class="info-icon">üí°</div>
                        <div class="info-text">
                            <div class="info-label">–ü–æ–¥—Å–∫–∞–∑–æ–∫</div>
                            <div class="info-value" id="hintsLeft">3/3</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="story-section">
                <h3>üìú –õ–µ–≥–µ–Ω–¥–∞</h3>
                <div class="story-text">
                    <p>–¢–µ–Ω—å –°–µ—Ç–∏ –ø—Ä–æ–Ω–∏–∫–ª–∞ –≤ –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω—é –∏ –ø–æ—Ö–∏—Ç–∏–ª–∞ —à–µ—Å—Ç—å –∞–º—É–ª–µ—Ç–æ–≤ –∑–∞—â–∏—Ç—ã. –ë–µ–∑ –Ω–∏—Ö –¥–µ—Ä–µ–≤–Ω—è –æ–±—Ä–µ—á–µ–Ω–∞!</p>
                    <p>–¢–≤–æ—è –º–∏—Å—Å–∏—è ‚Äî –ø—Ä–æ–π—Ç–∏ —á–µ—Ä–µ–∑ —à–µ—Å—Ç—å –º–∞–≥–∏—á–µ—Å–∫–∏—Ö –ª–æ–∫–∞—Ü–∏–π, –Ω–∞–π—Ç–∏ –ø–∞—Ä–æ–ª–∏ –¥–æ—Å—Ç—É–ø–∞ –∏ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –∞–º—É–ª–µ—Ç—ã.</p>
                    <p>–ö–∞–∂–¥–∞—è –ª–æ–∫–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç —Å–≤–æ–π —Å–µ–∫—Ä–µ—Ç. –ò—â–∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–π –∏—Ö –º—É–¥—Ä–æ!</p>
                </div>
            </div>

            <div class="locations-section">
                <h3>üó∫Ô∏è –ö–∞—Ä—Ç–∞ –ª–æ–∫–∞—Ü–∏–π</h3>
                <div class="locations-grid" id="locationsGrid">
                    <!-- –õ–æ–∫–∞—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>

            <div class="actions-section">
                <button class="action-button primary" id="startButton">
                    üöÄ –ù–ê–ß–ê–¢–¨ –ö–í–ï–°–¢
                </button>
                <button class="action-button secondary" id="resetButton">
                    üîÑ –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                </button>
            </div>

            <div class="web-note" id="webNote">
                ‚ÑπÔ∏è –≠—Ç–æ –≤–µ–±-–≤–µ—Ä—Å–∏—è. –í Telegram –¥–æ—Å—Ç—É–ø–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.
            </div>
        </main>

        <footer>
            <p>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π –∫–≤–µ—Å—Ç–∞ ‚Ä¢ <span id="currentTime"></span></p>
            <div class="commands-info">
                <p><strong>–ö–æ–º–∞–Ω–¥—ã –≤ Telegram:</strong></p>
                <p><code>/start</code> - –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É</p>
                <p><code>/hint</code> - –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</p>
                <p><code>/stats</code> - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</p>
                <p><code>/admin</code> - –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</p>
            </div>
        </footer>
    </div>

    <script src="telegram.js"></script>
    <script src="game.js"></script>
    <script>
        let locationsData = [];

        document.addEventListener('telegramReady', (event) => {
            const { isTelegram, userData, isWebVersion } = event.detail;

            if (isWebVersion) {
                document.getElementById('webNote').style.display = 'block';
                document.body.classList.add('web-version');
            } else {
                document.getElementById('webNote').style.display = 'none';
                document.body.classList.remove('web-version');
            }

            if (userData) {
                document.getElementById('userInfo').innerHTML = `
                    <div class="user-avatar">${userData.firstName?.[0] || 'üë§'}</div>
                    <div class="user-name">${userData.firstName || '–ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂'}</div>
                `;
            }

            updateProgressDisplay();
            loadLocations();
        });

        function updateProgressDisplay() {
            const completed = gameEngine.completedLocations.size;
            const hintsLeft = gameEngine.getHintsLeft();
            
            document.getElementById('locationsCount').textContent = `${completed}/6`;
            document.getElementById('amuletsCount').textContent = `${completed}/6`;
            document.getElementById('hintsLeft').textContent = `${hintsLeft}/3`;
        }

        function loadLocations() {
            locationsData = tgApp.getAllLocations();
            const grid = document.getElementById('locationsGrid');
            grid.innerHTML = '';

            locationsData.forEach(location => {
                const locationCard = document.createElement('div');
                locationCard.className = 'location-card';
                
                const isCompleted = gameEngine.completedLocations.has(location.id);
                const canAccess = gameEngine.canAccessLocation(location.id) || isCompleted;
                const statusClass = isCompleted ? 'completed' : (canAccess ? 'available' : 'locked');

                locationCard.innerHTML = `
                    <div class="location-icon">${location.emoji}</div>
                    <div class="location-info">
                        <div class="location-name">${location.name}</div>
                        <div class="location-status ${statusClass}">
                            ${isCompleted ? '‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ' : (canAccess ? '‚û°Ô∏è –ü–µ—Ä–µ–π—Ç–∏' : 'üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ')}
                        </div>
                    </div>
                `;

                if (canAccess) {
                    locationCard.addEventListener('click', () => {
                        window.location.href = `locations/${location.id}.html`;
                    });
                }

                grid.appendChild(locationCard);
            });
        }

        document.getElementById('startButton').addEventListener('click', async () => {
            await tgApp.sendGameEvent('quest_started', {
                teamId: tgApp.userData.teamId
            });

            tgApp.showAlert('‚úÖ –ö–≤–µ—Å—Ç –Ω–∞—á–∞—Ç! –£–¥–∞—á–∏, –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂!');
        });

        document.getElementById('resetButton').addEventListener('click', () => {
            tgApp.showConfirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?', (result) => {
                if (result) {
                    gameEngine.resetProgress();
                    updateProgressDisplay();
                    loadLocations();
                    tgApp.showAlert('üîÑ –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–±—Ä–æ—à–µ–Ω!');
                }
            });
        });

        function updateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            document.getElementById('currentTime').textContent = timeStr;
        }

        setInterval(updateTime, 1000);
        updateTime();
    </script>
</body>
</html>
