<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="telegram-app" content="true">
    <title>–ó–∞—â–∏—Ç–∞ –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω–∏</title>
    <link rel="stylesheet" href="style.css">
    <link rel="manifest" href="/manifest.json">
    <script src="telegram.js" defer></script>
    <script>
        // Service Worker –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º–∞
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
    </script>
</head>
<body>
    <div class="container">
        <header>
            <button class="back-button" onclick="tgApp.closeApp()">‚Üê</button>
            <div class="logo">üõ°Ô∏è –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω—è</div>
            <div class="user-info" id="userInfo"></div>
        </header>

        <main>
            <div class="story">
                <h1>–ü—Ä–∏–∑—ã–≤ –•—Ä–∞–Ω–∏—Ç–µ–ª—è</h1>
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂–∏! –í–∏—Ä—É—Å "–¢–µ–Ω—å –°–µ—Ç–∏" –∞—Ç–∞–∫–æ–≤–∞–ª –Ω–∞—à—É —Ü–∏—Ñ—Ä–æ–≤—É—é –¥–µ—Ä–µ–≤–Ω—é. 
                –í–∞—à–∞ –º–∏—Å—Å–∏—è ‚Äî —Å–æ–±—Ä–∞—Ç—å <span class="highlight">6 —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–º—É–ª–µ—Ç–æ–≤</span> –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 
                <span class="highlight">–ò–º–º—É–Ω–Ω—ã–π –©–∏—Ç</span>, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö.</p>
                
                <div class="video-container">
                    <div class="video-placeholder">
                        <div class="play-icon">‚ñ∂</div>
                        <p>–í–∏–¥–µ–æ —Å –•—Ä–∞–Ω–∏—Ç–µ–ª–µ–º</p>
                    </div>
                </div>
            </div>

            <div class="level-selection">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</h2>
                <div class="level-cards">
                    <div class="card beginner" onclick="setLevel('beginner')">
                        <h3>üéØ –ù–æ–≤–∏—á–æ–∫</h3>
                        <p>–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≥–∞–¥–∫–∏ –∏ –ø—Ä–æ—Å—Ç—ã–µ —à–∏—Ñ—Ä—ã. –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏–π –≤ IT.</p>
                        <ul>
                            <li>–ó–µ—Ä–∫–∞–ª—å–Ω—ã–µ —Å–ª–æ–≤–∞</li>
                            <li>–¶–≤–µ—Ç–æ–≤—ã–µ –∫–æ–¥—ã</li>
                            <li>–ú–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–º–µ—Ä—ã</li>
                        </ul>
                    </div>
                    <div class="card pro" onclick="setLevel('pro')">
                        <h3>üíª –ü—Ä–æ—Ñ–∏</h3>
                        <p>–ó–∞–¥–∞–Ω–∏—è —Å –±–∞–∑–æ–≤—ã–º–∏ –ò–ë-–Ω–∞–≤—ã–∫–∞–º–∏. –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è —à–∏—Ñ—Ä–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.</p>
                        <ul>
                            <li>Base64/XOR</li>
                            <li>–ê–Ω–∞–ª–∏–∑ –ª–æ–≥–æ–≤</li>
                            <li>–ü–æ–∏—Å–∫ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="start-section">
                <button class="start-button" id="startButton" disabled>
                    –ù–ê–ß–ê–¢–¨ –ú–ò–°–°–ò–Æ
                </button>
            </div>
        </main>

        <footer>
            <p>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂–µ–π ‚Ä¢ <span id="current-time"></span></p>
        </footer>
    </div>

    <div class="close-button">‚úï</div>

    <script>
        // –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram
        document.addEventListener('telegramReady', () => {
            updateUserInfo();
            document.getElementById('startButton').disabled = false;
        });

        function updateUserInfo() {
            const userInfo = document.getElementById('userInfo');
            if (tgApp.isTelegram && tgApp.userData) {
                userInfo.innerHTML = `
                    <div class="user-avatar">${tgApp.userData.firstName?.[0] || 'üë§'}</div>
                    <div class="user-name">${tgApp.userData.firstName || '–ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂'}</div>
                `;
            }
        }

        function setLevel(level) {
            tgApp.saveProgress('cybervillage_level', level);
            document.querySelectorAll('.card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            tgApp.showAlert(`–£—Ä–æ–≤–µ–Ω—å "${level === 'beginner' ? '–ù–æ–≤–∏—á–æ–∫' : '–ü—Ä–æ—Ñ–∏'}" –≤—ã–±—Ä–∞–Ω!`, () => {
                document.querySelector('.start-section').scrollIntoView({ behavior: 'smooth' });
            });
        }

        document.getElementById('startButton').addEventListener('click', () => {
            if (!tgApp.userData?.level) {
                tgApp.showAlert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏!', () => {
                    document.querySelector('.level-selection').scrollIntoView({ behavior: 'smooth' });
                });
                return;
            }
            
            tgApp.saveProgress('cybervillage_registered', 'true');
            tgApp.saveProgress('cybervillage_start_time', new Date().toISOString());
            
            tgApp.showConfirm(
                '–ù–∞—á–∞—Ç—å –º–∏—Å—Å–∏—é –ø–æ —Å–ø–∞—Å–µ–Ω–∏—é –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω–∏?',
                () => {
                    window.location.href = `map.html?team=${tgApp.userData.teamId}&level=${tgApp.userData.level}`;
                }
            );
        });

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateTime, 1000);
        updateTime();
    </script>
</body>
</html>
