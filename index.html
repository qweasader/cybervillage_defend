<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="format-detection" content="telephone=no">
    <meta name="theme-color" content="#6a11cb">
    <title>–ó–∞—â–∏—Ç–∞ –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω–∏</title>
    <link rel="stylesheet" href="style.css">
    <script src="telegram.js" defer></script>
    <script src="game.js" defer></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üõ°Ô∏è –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω—è</div>
            <div class="user-info" id="userInfo"></div>
        </header>

        <main>
            <div class="story">
                <h1>–ü—Ä–∏–∑—ã–≤ –•—Ä–∞–Ω–∏—Ç–µ–ª—è</h1>
                <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂–∏! –í–∏—Ä—É—Å "–¢–µ–Ω—å –°–µ—Ç–∏" –∞—Ç–∞–∫–æ–≤–∞–ª –Ω–∞—à—É —Ü–∏—Ñ—Ä–æ–≤—É—é –¥–µ—Ä–µ–≤–Ω—é. 
                –í–∞—à–∞ –º–∏—Å—Å–∏—è ‚Äî —Å–æ–±—Ä–∞—Ç—å <span class="highlight">6 —Ü–∏—Ñ—Ä–æ–≤—ã—Ö –∞–º—É–ª–µ—Ç–æ–≤</span> –∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å 
                <span class="highlight">–ò–º–º—É–Ω–Ω—ã–π –©–∏—Ç</span>, —á—Ç–æ–±—ã —Å–ø–∞—Å—Ç–∏ –≤—Å–µ—Ö —Ö—Ä–∞–Ω–∏—Ç–µ–ª–µ–π –¥–∞–Ω–Ω—ã—Ö.</p>
            </div>

            <div class="level-selection">
                <h2>–í—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</h2>
                <div class="level-cards">
                    <div class="card beginner" data-level="beginner">
                        <h3>üéØ –ù–æ–≤–∏—á–æ–∫</h3>
                        <p>–õ–æ–≥–∏—á–µ—Å–∫–∏–µ –∑–∞–≥–∞–¥–∫–∏ –∏ –ø—Ä–æ—Å—Ç—ã–µ —à–∏—Ñ—Ä—ã. –ù–µ —Ç—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏–π –≤ IT.</p>
                    </div>
                    <div class="card pro" data-level="pro">
                        <h3>üíª –ü—Ä–æ—Ñ–∏</h3>
                        <p>–ó–∞–¥–∞–Ω–∏—è —Å –±–∞–∑–æ–≤—ã–º–∏ –ò–ë-–Ω–∞–≤—ã–∫–∞–º–∏. –¢—Ä–µ–±—É–µ—Ç –∑–Ω–∞–Ω–∏—è —à–∏—Ñ—Ä–æ–≤ –∏ –∞–Ω–∞–ª–∏–∑–∞ –¥–∞–Ω–Ω—ã—Ö.</p>
                    </div>
                </div>
            </div>

            <div class="start-section">
                <button class="start-button" id="startButton" disabled>
                    –ù–ê–ß–ê–¢–¨ –ú–ò–°–°–ò–Æ
                </button>
                <p class="web-note" id="webNote">‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Telegram –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞.</p>
            </div>
        </main>

        <footer>
            <p>–û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–æ –∫–æ–º–∞–Ω–¥–æ–π –ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂–µ–π ‚Ä¢ <span id="current-time"></span></p>
        </footer>
    </div>

    <script>
        document.addEventListener('telegramReady', (event) => {
            const { isTelegram, userData, isWebVersion } = event.detail;
            
            if (isWebVersion) {
                document.getElementById('webNote').style.display = 'block';
                document.body.classList.add('web-version');
            } else {
                document.getElementById('webNote').style.display = 'none';
                document.body.classList.remove('web-version');
            }
            
            // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
            setTimeout(() => {
                document.getElementById('startButton').disabled = false;
            }, 500);
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
            if (userData) {
                document.getElementById('userInfo').innerHTML = `
                    <div class="user-avatar">${userData.firstName?.[0] || 'üë§'}</div>
                    <div class="user-name">${userData.firstName || '–ö–∏–±–µ—Ä—Å—Ç—Ä–∞–∂'}</div>
                `;
            }
        });

        // –í—ã–±–æ—Ä —É—Ä–æ–≤–Ω—è —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        document.querySelectorAll('.card').forEach(card => {
            card.addEventListener('click', () => {
                const level = card.getAttribute('data-level');
                
                // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è
                tgApp.userData.level = level;
                localStorage.setItem('cybervillage_level', level);
                
                // –í–∏–∑—É–∞–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å
                document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
                card.classList.add('selected');
                
                // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
                tgApp.showAlert(`–£—Ä–æ–≤–µ–Ω—å "${level === 'beginner' ? '–ù–æ–≤–∏—á–æ–∫' : '–ü—Ä–æ—Ñ–∏'}" –≤—ã–±—Ä–∞–Ω!`);
            });
        });

        // –ö–Ω–æ–ø–∫–∞ —Å—Ç–∞—Ä—Ç–∞
        document.getElementById('startButton').addEventListener('click', async () => {
            if (!tgApp.userData?.level) {
                tgApp.showAlert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏!');
                return;
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–±—ã—Ç–∏—è –Ω–∞—á–∞–ª–∞ –º–∏—Å—Å–∏–∏
            await tgApp.sendMissionStarted();
            
            tgApp.showAlert('‚úÖ –ú–∏—Å—Å–∏—è –Ω–∞—á–∞—Ç–∞! –ò—â–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∞–º—É–ª–µ—Ç –≤ –°–µ—Ä–≤–µ—Ä–Ω–æ–º –õ–µ—Å—É.', () => {
                // –ó–¥–µ—Å—å –±—É–¥–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –∫ –ø–µ—Ä–≤–æ–π –ª–æ–∫–∞—Ü–∏–∏ –≤ –ø–æ–ª–Ω–æ–π –≤–µ—Ä—Å–∏–∏
                console.log('Mission started, redirecting to first location...');
            });
        });

        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
        function updateTime() {
            const now = new Date();
            document.getElementById('current-time').textContent = 
                now.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
        }
        setInterval(updateTime, 1000);
        updateTime();
    </script>
</body>
</html>
