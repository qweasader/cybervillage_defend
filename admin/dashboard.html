<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å - –ö–∏–±–µ—Ä–¥–µ—Ä–µ–≤–Ω—è</title>
    <link rel="stylesheet" href="../style.css">
    <script src="../telegram.js" defer></script>
    <script src="../game.js" defer></script>
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #6a11cb;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            text-align: center;
        }
        
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: #6a11cb;
            margin: 10px 0;
        }
        
        .triggers-section {
            background: white;
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        
        .trigger-item {
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .trigger-controls {
            display: flex;
            gap: 10px;
        }
        
        .trigger-btn {
            padding: 6px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        
        .trigger-btn.activate {
            background: #4caf50;
            color: white;
        }
        
        .trigger-btn.delete {
            background: #f44336;
            color: white;
        }
        
        .manual-trigger {
            background: #2196f3;
            color: white;
        }
        
        .event-form {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 12px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        .submit-btn {
            background: linear-gradient(45deg, #6a11cb, #2575fc);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(106, 17, 203, 0.4);
        }
        
        .system-messages {
            margin-top: 30px;
        }
        
        .message-item {
            padding: 12px 15px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: #e8f4ff;
            border-left: 4px solid #2196f3;
        }
        
        .hidden {
            display: none;
        }
        
        .empty-state {
            text-align: center;
            color: #6c757d;
            padding: 20px;
        }
        
        .error {
            color: #ff1744;
            text-align: center;
            padding: 10px;
        }
        
        .trigger-note {
            font-size: 0.9rem;
            color: #6c757d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">üõ°Ô∏è –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å</div>
            <div class="user-info" id="userInfo"></div>
        </header>

        <main class="admin-container">
            <div class="admin-header">
                <h1>–ö–æ–Ω—Ç—Ä–æ–ª—å–Ω–∞—è –ø–∞–Ω–µ–ª—å –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞</h1>
                <div class="controls">
                    <button class="trigger-btn manual-trigger" onclick="sendEmergencyAlert()">
                        üö® –°–†–û–ß–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï
                    </button>
                </div>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>–ê–∫—Ç–∏–≤–Ω—ã–µ –∏–≥—Ä–æ–∫–∏</h3>
                    <div class="stat-value" id="activePlayers">0</div>
                    <p>–í —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç</p>
                </div>
                <div class="stat-card">
                    <h3>–°–æ–±—Ä–∞–Ω–æ –∞–º—É–ª–µ—Ç–æ–≤</h3>
                    <div class="stat-value" id="totalAmulets">0</div>
                    <p>–í—Å–µ–≥–æ –∑–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ</p>
                </div>
                <div class="stat-card">
                    <h3>–ó–∞–ø—Ä–æ—à–µ–Ω–æ –ø–æ–¥—Å–∫–∞–∑–æ–∫</h3>
                    <div class="stat-value" id="totalHints">0</div>
                    <p>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 24 —á–∞—Å–∞</p>
                </div>
                <div class="stat-card">
                    <h3>–°–∏—Å—Ç–µ–º–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è</h3>
                    <div class="stat-value" id="systemEvents">0</div>
                    <p>–°–µ–≥–æ–¥–Ω—è</p>
                </div>
            </div>

            <div class="triggers-section">
                <h2>–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤</h2>
                <p>–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Å–æ–±—ã—Ç–∏—è –ø–æ –≤—Ä–µ–º–µ–Ω–∏, QR-–∫–æ–¥–∞–º –∏ –ø—Ä–æ–≥—Ä–µ—Å—Å—É –∏–≥—Ä–æ–∫–æ–≤</p>
                
                <div class="trigger-list" id="triggerList">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤...</p>
                </div>
                
                <div class="event-form">
                    <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ —Å–æ–±—ã—Ç–∏–µ</h3>
                    <form id="triggerForm">
                        <div class="form-group">
                            <label for="triggerType">–¢–∏–ø —Ç—Ä–∏–≥–≥–µ—Ä–∞</label>
                            <select id="triggerType" required>
                                <option value="time">–ü–æ –≤—Ä–µ–º–µ–Ω–∏</option>
                                <option value="qr_scan">–ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR</option>
                                <option value="location">–ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏</option>
                                <option value="amulets">–ü—Ä–∏ —Å–±–æ—Ä–µ –∞–º—É–ª–µ—Ç–æ–≤</option>
                            </select>
                        </div>
                        
                        <div class="form-group" id="timeField">
                            <label for="triggerTime">–í—Ä–µ–º—è —Å–æ–±—ã—Ç–∏—è</label>
                            <input type="datetime-local" id="triggerTime" required>
                        </div>
                        
                        <div class="form-group hidden" id="qrField">
                            <label for="triggerQrId">ID QR –∫–æ–¥–∞</label>
                            <input type="text" id="triggerQrId" placeholder="qr_forest_01" required>
                        </div>
                        
                        <div class="form-group hidden" id="locationField">
                            <label for="triggerLocation">–õ–æ–∫–∞—Ü–∏—è</label>
                            <select id="triggerLocation" required>
                                <option value="forest">–°–µ—Ä–≤–µ—Ä–Ω—ã–π –õ–µ—Å</option>
                                <option value="bridge">–ú–æ—Å—Ç VPN</option>
                                <option value="lake">–û–∑–µ—Ä–æ –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è</option>
                                <option value="phishing">–ü–æ–ª–µ –§–∏—à–∏–Ω–≥–∞</option>
                                <option value="storage">–°–∫–ª–∞–¥ –î–∞–Ω–Ω—ã—Ö</option>
                                <option value="firewall">–ë–∞—à–Ω—è –ë—Ä–∞–Ω–¥–º–∞—É—ç—Ä–∞</option>
                            </select>
                        </div>
                        
                        <div class="form-group hidden" id="amuletsField">
                            <label for="triggerAmulets">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–º—É–ª–µ—Ç–æ–≤</label>
                            <input type="number" id="triggerAmulets" min="1" max="6" value="3" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="triggerMessage">–°–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤</label>
                            <textarea id="triggerMessage" rows="3" required placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∏–≥—Ä–æ–∫–æ–≤"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="triggerAdminNote">–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤</label>
                            <input type="text" id="triggerAdminNote" placeholder="–ù–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø—Ä–∏–º–µ—á–∞–Ω–∏–µ">
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="broadcastAll" checked>
                                –û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º
                            </label>
                        </div>
                        
                        <button type="submit" class="submit-btn">–°–û–ó–î–ê–¢–¨ –¢–†–ò–ì–ì–ï–†</button>
                    </form>
                </div>
            </div>

            <div class="system-messages">
                <h2>–õ–µ–Ω—Ç–∞ —Å–æ–±—ã—Ç–∏–π</h2>
                <div id="eventsFeed">
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π...</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('telegramReady', async () => {
            if (!tgApp.isAdmin()) {
                tgApp.showAlert('–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â–µ–Ω! –¢–æ–ª—å–∫–æ –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤.', () => {
                    window.location.href = '../index.html';
                });
                return;
            }
            
            await Promise.all([
                loadDashboardData(),
                loadTriggers(),
                loadEventsFeed()
            ]);
            
            setupTriggerForm();
        });

        async function loadDashboardData() {
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/admin-dashboard?action=dashboard-data`, {
                    headers: {
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('activePlayers').textContent = data.activePlayers;
                    document.getElementById('totalAmulets').textContent = data.totalAmulets;
                    document.getElementById('totalHints').textContent = data.totalHints;
                    document.getElementById('systemEvents').textContent = data.systemEvents;
                }
            } catch (error) {
                console.error('Dashboard data error:', error);
            }
        }

        async function loadTriggers() {
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/triggers`, {
                    headers: {
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    }
                });
                
                if (response.ok) {
                    const triggers = await response.json();
                    renderTriggers(triggers);
                }
            } catch (error) {
                console.error('Triggers load error:', error);
                document.getElementById('triggerList').innerHTML = '<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤</p>';
            }
        }

        async function loadEventsFeed() {
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/admin-dashboard?action=recent-events`, {
                    headers: {
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    }
                });
                
                if (response.ok) {
                    const events = await response.json();
                    renderEventsFeed(events);
                }
            } catch (error) {
                console.error('Events feed error:', error);
                document.getElementById('eventsFeed').innerHTML = '<p class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–æ–±—ã—Ç–∏–π</p>';
            }
        }

        function renderTriggers(triggers) {
            const container = document.getElementById('triggerList');
            
            if (triggers.length === 0) {
                container.innerHTML = '<p class="empty-state">–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ç—Ä–∏–≥–≥–µ—Ä–æ–≤</p>';
                return;
            }
            
            let html = '';
            triggers.forEach(trigger => {
                html += `
                    <div class="trigger-item" data-trigger-id="${trigger.id}">
                        <div class="trigger-info">
                            <strong>${getTriggerTypeName(trigger.type)}</strong><br>
                            ${getTriggerDetails(trigger)}
                            ${trigger.adminNote ? `<div class="trigger-note">${trigger.adminNote}</div>` : ''}
                        </div>
                        <div class="trigger-controls">
                            <button class="trigger-btn activate" onclick="activateTrigger('${trigger.id}')">
                                ‚úÖ –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å
                            </button>
                            <button class="trigger-btn delete" onclick="deleteTrigger('${trigger.id}')">
                                üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function renderEventsFeed(events) {
            const container = document.getElementById('eventsFeed');
            
            if (events.length === 0) {
                container.innerHTML = '<p class="empty-state">–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –∑–∞ —Å–µ–≥–æ–¥–Ω—è</p>';
                return;
            }
            
            let html = '';
            events.slice(0, 20).forEach(event => {
                const time = new Date(event.timestamp).toLocaleTimeString('ru-RU');
                const color = getEventColor(event.type);
                
                html += `
                    <div class="message-item">
                        <strong style="color: ${color}">[${time}] ${event.type}</strong><br>
                        ${event.message || JSON.stringify(event.data).substring(0, 100) + '...'}
                        ${event.data?.userId ? `<br><small>–ò–≥—Ä–æ–∫: ${event.data.userId}</small>` : ''}
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function getTriggerTypeName(type) {
            const types = {
                'time': '‚è∞ –ü–æ –≤—Ä–µ–º–µ–Ω–∏',
                'qr_scan': 'üì∑ –ü—Ä–∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏ QR',
                'location': 'üìç –ü—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–æ–∫–∞—Ü–∏–∏',
                'amulets': 'üíé –ü—Ä–∏ —Å–±–æ—Ä–µ –∞–º—É–ª–µ—Ç–æ–≤'
            };
            return types[type] || type;
        }

        function getTriggerDetails(trigger) {
            switch (trigger.type) {
                case 'time':
                    return `–í—Ä–µ–º—è: ${new Date(trigger.time).toLocaleString('ru-RU')}`;
                case 'qr_scan':
                    return `QR ID: ${trigger.qrId}`;
                case 'location':
                    return `–õ–æ–∫–∞—Ü–∏—è: ${trigger.location}`;
                case 'amulets':
                    return `–ê–º—É–ª–µ—Ç–æ–≤: ${trigger.count}/6`;
                default:
                    return '';
            }
        }

        function getEventColor(type) {
            const colors = {
                'trigger_activated': '#ff9100',
                'emergency_alert_sent': '#ff1744',
                'trigger_created': '#4caf50',
                'trigger_deleted': '#f44336',
                'amulet_collected': '#2196f3',
                'mission_started': '#9c27b0',
                'qr_scanned': '#3f51b5'
            };
            return colors[type] || '#2196f3';
        }

        async function activateTrigger(triggerId) {
            if (!confirm('–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —ç—Ç–æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ?')) return;
            
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/triggers`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    },
                    body: JSON.stringify({ triggerId })
                });
                
                if (response.ok) {
                    tgApp.showAlert('‚úÖ –¢—Ä–∏–≥–≥–µ—Ä —É—Å–ø–µ—à–Ω–æ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω!');
                    await loadTriggers();
                    await loadEventsFeed();
                } else {
                    const error = await response.json();
                    tgApp.showAlert(`‚ùå –û—à–∏–±–∫–∞: ${error.error}`);
                }
            } catch (error) {
                console.error('Trigger activation error:', error);
                tgApp.showAlert('‚ùå –û—à–∏–±–∫–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞');
            }
        }

        async function deleteTrigger(triggerId) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç—Ä–∏–≥–≥–µ—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) return;
            
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/admin-dashboard?action=delete-trigger`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    },
                    body: JSON.stringify({ triggerId })
                });
                
                if (response.ok) {
                    tgApp.showAlert('‚úÖ –¢—Ä–∏–≥–≥–µ—Ä —É–¥–∞–ª–µ–Ω');
                    await loadTriggers();
                } else {
                    const error = await response.json();
                    tgApp.showAlert(`‚ùå –û—à–∏–±–∫–∞: ${error.error}`);
                }
            } catch (error) {
                console.error('Trigger delete error:', error);
                tgApp.showAlert('‚ùå –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞');
            }
        }

        function setupTriggerForm() {
            const typeSelect = document.getElementById('triggerType');
            const timeField = document.getElementById('timeField');
            const qrField = document.getElementById('qrField');
            const locationField = document.getElementById('locationField');
            const amuletsField = document.getElementById('amuletsField');
            
            typeSelect.addEventListener('change', (e) => {
                timeField.classList.add('hidden');
                qrField.classList.add('hidden');
                locationField.classList.add('hidden');
                amuletsField.classList.add('hidden');
                
                switch (e.target.value) {
                    case 'time': timeField.classList.remove('hidden'); break;
                    case 'qr_scan': qrField.classList.remove('hidden'); break;
                    case 'location': locationField.classList.remove('hidden'); break;
                    case 'amulets': amuletsField.classList.remove('hidden'); break;
                }
            });
            
            document.getElementById('triggerForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = {
                    type: typeSelect.value,
                    message: document.getElementById('triggerMessage').value,
                    adminNote: document.getElementById('triggerAdminNote').value || undefined,
                    showMessage: true,
                    broadcastAll: document.getElementById('broadcastAll').checked
                };
                
                switch (formData.type) {
                    case 'time':
                        formData.time = document.getElementById('triggerTime').value;
                        break;
                    case 'qr_scan':
                        formData.qrId = document.getElementById('triggerQrId').value;
                        break;
                    case 'location':
                        formData.location = document.getElementById('triggerLocation').value;
                        break;
                    case 'amulets':
                        formData.count = parseInt(document.getElementById('triggerAmulets').value);
                        break;
                }
                
                try {
                    const response = await fetch(`${tgApp.backendUrl}/api/admin-dashboard?action=create-trigger`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-Telegram-Init-Data': tgApp.userData.initData
                        },
                        body: JSON.stringify(formData)
                    });
                    
                    if (response.ok) {
                        tgApp.showAlert('‚úÖ –¢—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω —É—Å–ø–µ—à–Ω–æ!');
                        document.getElementById('triggerForm').reset();
                        document.getElementById('timeField').classList.add('hidden');
                        document.getElementById('qrField').classList.add('hidden');
                        document.getElementById('locationField').classList.add('hidden');
                        document.getElementById('amuletsField').classList.add('hidden');
                        await loadTriggers();
                    } else {
                        const error = await response.json();
                        tgApp.showAlert(`‚ùå –û—à–∏–±–∫–∞: ${error.error}`);
                    }
                } catch (error) {
                    console.error('Trigger create error:', error);
                    tgApp.showAlert('‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞');
                }
            });
        }

        async function sendEmergencyAlert() {
            const message = prompt('–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —Å—Ä–æ—á–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤:');
            if (!message) return;
            
            if (!confirm('–û—Ç–ø—Ä–∞–≤–∏—Ç—å –°–†–û–ß–ù–û–ï –°–û–û–ë–©–ï–ù–ò–ï –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º?\n\n' + message)) return;
            
            try {
                const response = await fetch(`${tgApp.backendUrl}/api/admin-dashboard?action=emergency-alert`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-Telegram-Init-Data': tgApp.userData.initData
                    },
                    body: JSON.stringify({ message })
                });
                
                if (response.ok) {
                    tgApp.showAlert('‚úÖ –°—Ä–æ—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –≤—Å–µ–º –∏–≥—Ä–æ–∫–∞–º!');
                    await loadEventsFeed();
                } else {
                    const error = await response.json();
                    tgApp.showAlert(`‚ùå –û—à–∏–±–∫–∞: ${error.error}`);
                }
            } catch (error) {
                console.error('Emergency alert error:', error);
                tgApp.showAlert('‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è');
            }
        }

        setInterval(async () => {
            if (tgApp.isAdmin()) {
                await loadDashboardData();
                await loadEventsFeed();
            }
        }, 30000);
    </script>
</body>
</html>